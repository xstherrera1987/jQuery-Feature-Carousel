/*!
 * Feature Carousel, Version 1.3
 * http://www.bkosolutions.com
 *
 * Copyright 2011 Brian Osborne
 * Licensed under GPL version 3
 * brian@bkosborne.com
 *
 * http://www.gnu.org/licenses/gpl.txt
 */
!function(t){t.fn.featureCarousel=function(e){if(this.length>1)return this.each(function(){t(this).featureCarousel(e)}),this;e=t.extend({},t.fn.featureCarousel.defaults,e||{});var a={currentCenterNum:e.startingFeature,containerWidth:0,containerHeight:0,largeFeatureWidth:0,largeFeatureHeight:0,smallFeatureWidth:0,smallFeatureHeight:0,totalFeatureCount:t(this).children("div").length,currentlyMoving:!1,featuresContainer:t(this),featuresArray:[],containerIDTag:"#"+t(this).attr("id"),timeoutVar:null,rotationsRemaining:0,itemsToAnimate:0,borderWidth:0},i=function(i){if(1==e.preload){var r=a.featuresContainer.find("img"),n=0,o=r.length;r.each(function(e,a){var r=new Image;t(r).bind("load error",function(){n++,n==o&&i()}),r.src=a.src})}else i()},r=function(t){return a.featuresArray[t-1]},n=function(t){return t-1==0?a.totalFeatureCount:t-1},o=function(t){return t+1>a.totalFeatureCount?1:t+1},u=function(){a.containerWidth=a.featuresContainer.width(),a.containerHeight=a.featuresContainer.height();var i=t(a.containerIDTag).find(".carousel-image:first");a.largeFeatureWidth=e.largeFeatureWidth>1?e.largeFeatureWidth:e.largeFeatureWidth>0&&e.largeFeatureWidth<1?i.width()*e.largeFeatureWidth:i.outerWidth(),a.largeFeatureHeight=e.largeFeatureHeight>1?e.largeFeatureHeight:e.largeFeatureHeight>0&&e.largeFeatureHeight<1?i.height()*e.largeFeatureHeight:i.outerHeight(),a.smallFeatureWidth=e.smallFeatureWidth>1?e.smallFeatureWidth:e.smallFeatureWidth>0&&e.smallFeatureWidth<1?i.width()*e.smallFeatureWidth:i.outerWidth()/2,a.smallFeatureHeight=e.smallFeatureHeight>1?e.smallFeatureHeight:e.smallFeatureHeight>0&&e.smallFeatureHeight<1?i.height()*e.smallFeatureHeight:i.outerHeight()/2},s=function(){e.displayCutoff>0&&e.displayCutoff<a.totalFeatureCount&&(a.totalFeatureCount=e.displayCutoff),a.featuresContainer.find(".carousel-feature").each(function(e){e<a.totalFeatureCount&&(a.featuresArray[e]=t(this))}),"medium"!=a.featuresContainer.find(".carousel-feature").first().css("borderLeftWidth")&&(a.borderWidth=2*parseInt(a.featuresContainer.find(".carousel-feature").first().css("borderLeftWidth"))),a.featuresContainer.find(".carousel-feature").each(function(){t(this).css({left:a.containerWidth/2-a.smallFeatureWidth/2-a.borderWidth/2,width:a.smallFeatureWidth,height:a.smallFeatureHeight,top:e.smallFeatureOffset+e.topPadding,opacity:0})}).find(".carousel-image").css({width:a.smallFeatureWidth}),e.captionBelow&&a.featuresContainer.find(".carousel-caption").css("position","relative"),a.itemsToAnimate=a.totalFeatureCount<4?a.totalFeatureCount:4,a.featuresContainer.find(".carousel-caption").hide()},l=function(){t.each(a.featuresArray,function(e){t(this).data("setPosition",e+1)});var i=n(e.startingFeature);a.currentCenterNum=i;var o=r(i);o.data("position",1);var u=o.prevAll();u.each(function(e){t(this).data("position",a.totalFeatureCount-e)});var s=o.nextAll();s.each(function(e){void 0!=t(this).data("setPosition")&&t(this).data("position",e+2)}),"caption"==e.counterStyle&&t.each(a.featuresArray,function(){var e=n(t(this).data("position")),i=t("<span></span>");i.addClass("numberTag"),i.html("("+e+" of "+a.totalFeatureCount+") "),t(this).find(".carousel-caption p").prepend(i)})},d=function(){if(e.trackerIndividual){var i=t("<ul></ul>");i.addClass("tracker-individual-container");for(var r=0;r<a.totalFeatureCount;r++){var n=r+1,o=t("<div>"+n+"</div>");o.addClass("tracker-individual-blip"),o.css("cursor","pointer"),o.attr("id","tracker-"+(r+1));var u=t("<li></li>");u.append(o),u.css("float","left"),u.css("list-style-type","none"),i.append(u)}t(a.containerIDTag).append(i),i.hide().show()}if(e.trackerSummation){var s=t("<div></div>");s.addClass("tracker-summation-container");var l=t("<span></span>").addClass("tracker-summation-current").text(e.startingFeature),d=t("<span></span>").addClass("tracker-summation-total").text(a.totalFeatureCount),c=t("<span></span>").addClass("tracker-summation-middle").text(" of ");s.append(l).append(c).append(d),t(a.containerIDTag).append(s)}},c=function(t,i){if(e.trackerIndividual){var r=a.featuresContainer.find(".tracker-individual-container"),n=r.find("#tracker-"+t),o=r.find("#tracker-"+i);n.removeClass("tracker-individual-blip-selected"),o.addClass("tracker-individual-blip-selected")}if(e.trackerSummation){var r=a.featuresContainer.find(".tracker-summation-container");r.find(".tracker-summation-current").text(i)}},f=function(t){if(clearTimeout(a.timeoutVar),!t&&0!=e.autoPlay){var i=Math.abs(e.autoPlay)<e.carouselSpeed?e.carouselSpeed:Math.abs(e.autoPlay);a.timeoutVar=setTimeout(function(){e.autoPlay>0?p(!0,1):p(!1,1)},i)}},h=function(e){t.each(a.featuresArray,function(){var a;a=0==e?o(t(this).data().position):n(t(this).data().position),t(this).data("position",a)})},g=function(t,i){var r,u,s,l,d,g,p,v=t.data("position");p=1==i?n(v):o(v),1==v&&e.leavingCenter(t),1==p?(r=a.largeFeatureWidth,u=a.largeFeatureHeight,s=e.topPadding,d=t.css("z-index"),l=a.containerWidth/2-a.largeFeatureWidth/2-a.borderWidth/2,g=1):(r=a.smallFeatureWidth,u=a.smallFeatureHeight,s=e.smallFeatureOffset+e.topPadding,d=1,g=.4,p==a.totalFeatureCount?l=e.sidePadding:2==p?l=a.containerWidth-a.smallFeatureWidth-e.sidePadding-a.borderWidth:(l=a.containerWidth/2-a.smallFeatureWidth/2-a.borderWidth/2,g=0)),1==v&&t.find(".carousel-caption").hide(),t.animate({width:r,height:u,top:s,left:l,opacity:g},e.carouselSpeed,e.animationEasing,function(){if(1==p&&(e.captionBelow&&t.css("height","auto"),t.find(".carousel-caption").fadeTo("fast",.85),e.movedToCenter(t)),a.rotationsRemaining=a.rotationsRemaining-1,t.css("z-index",d),(e.trackerIndividual||e.trackerSummation)&&1==p){var r,u=a.featuresContainer.find(".carousel-feature").index(t)+1;r=0==i?o(u):n(u),c(r,u)}var s=a.rotationsRemaining/a.itemsToAnimate;s%1==0&&(a.currentlyMoving=!1,h(i),a.rotationsRemaining>0&&m(i)),f(!1)}).find(".carousel-image").animate({width:r,height:u},e.carouselSpeed,e.animationEasing).end()},m=function(t){a.currentlyMoving=!0;var e,i,u,s;1==t?(e=r(o(a.currentCenterNum)),i=r(a.currentCenterNum),u=r(o(o(a.currentCenterNum))),s=r(n(a.currentCenterNum)),a.currentCenterNum=o(a.currentCenterNum)):(e=r(n(a.currentCenterNum)),i=r(n(n(a.currentCenterNum))),u=r(a.currentCenterNum),s=r(o(a.currentCenterNum)),a.currentCenterNum=n(a.currentCenterNum)),t?i.css("z-index",3):u.css("z-index",3),e.css("z-index",4),g(i,t),g(e,t),g(u,t),a.totalFeatureCount>3&&g(s,t)},p=function(t,e){if(0==a.currentlyMoving){var i=e*a.itemsToAnimate;a.rotationsRemaining=i,m(t)}},v=function(t,e){var a,i=1,r=1;for(a=t;(a=n(a))!=e;)i++;for(a=t;(a=o(a))!=e;)r++;return r>i?-1*i:r},C=t(e.leftButtonTag),F=function(){p(!1,1)};e.jqModern?C.on("click",null,F):C.live("click",F);var W=t(e.rightButtonTag),k=function(){p(!0,1)};e.jqModern?W.on("click",null,k):W.live("click",k),a.featuresContainer.find(".carousel-feature").click(function(){var e=t(this).data("position");2==e?p(!0,1):e==a.totalFeatureCount&&p(!1,1)}).mouseover(function(){if(0==a.currentlyMoving){var i=t(this).data("position");(2==i||i==a.totalFeatureCount)&&t(this).css("opacity",.8)}e.pauseOnHover&&f(!0),e.stopOnHover&&(e.autoPlay=0)}).mouseout(function(){if(0==a.currentlyMoving){var i=t(this).data("position");(2==i||i==a.totalFeatureCount)&&t(this).css("opacity",.4)}e.pauseOnHover&&f(!1)});var y=t("a",a.containerIDTag),H=function(i){var r=t(this).parentsUntil(a.containerIDTag);r.each(function(){var r=t(this).data("position");if(void 0!=r){if(1!=r)return r==a.totalFeatureCount?p(!1,1):2==r&&p(!0,1),i.preventDefault(),!1;e.clickedCenter(t(this))}})};e.jqModern?y.on("click",null,H):y.live("click",H);var T=t(".tracker-individual-blip",a.containerIDTag),b=function(){var e=t(this).attr("id").substring(8),i=a.featuresContainer.find(".carousel-feature").eq(e-1).data("position"),r=a.currentCenterNum;if(e!=r){var n=v(1,i);0>n?p(!1,-1*n):p(!0,n)}};return e.jqModern?T.on("click",null,b):T.live("click",b),this.initialize=function(){return i(function(){u(),s(),l(),d(),p(!0,1)}),this},this.next=function(){p(!0,1)},this.prev=function(){p(!1,1)},this.pause=function(){f(!0)},this.start=function(){f(!1)},this.initialize()},t.fn.featureCarousel.defaults={largeFeatureWidth:0,largeFeatureHeight:0,smallFeatureWidth:.5,smallFeatureHeight:.5,topPadding:20,sidePadding:50,smallFeatureOffset:50,startingFeature:1,carouselSpeed:1e3,autoPlay:4e3,pauseOnHover:!0,stopOnHover:!1,trackerIndividual:!0,trackerSummation:!0,preload:!0,displayCutoff:0,animationEasing:"swing",leftButtonTag:"#carousel-left",rightButtonTag:"#carousel-right",captionBelow:!1,movedToCenter:t.noop,leavingCenter:t.noop,clickedCenter:t.noop,jqModern:"undefined"!=typeof jQuery.fn.on}}(jQuery);